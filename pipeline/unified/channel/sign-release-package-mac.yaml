# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
parameters:
    unsignedPipelineResource: null
    unsignedArtifactName: null
    signedArtifactName: null

jobs:
    - template: sign-release-package.yaml
      parameters:
          unsignedPipelineResource: ${{ parameters.unsignedPipelineResource }}
          unsignedArtifactName: ${{ parameters.unsignedArtifactName }}
          signedArtifactName: ${{ parameters.signedArtifactName }}
          vmImage: macOS-10.15
          filePattern: '*.dmg, *.zip'
          platform: mac
          inlineSignParams: |
              [
                  {
                      "keyCode": "CP-401337-Apple",
                      "operationSetCode": "MacAppDeveloperSign",
                      "parameters": [],
                      "toolName": "sign",
                      "toolVersion": "1.0"
                  }
              ]

    - task: SFP.build-tasks.custom-build-task-1.EsrpCodeSigning@1
      displayName: 'Send to ESRP Code Signing service for notarization'
      inputs:
          ConnectedServiceName: 'ESRP Code Signing'
          FolderPath: '$(System.DefaultWorkingDirectory)/signing-in-progress/${{ parameters.signedArtifactName }}'
          Pattern: ${{ parameters.filePattern }}
          signConfigType: inlineSignParams
          inlineOperation: |
              [
                  {
                  "keyCode": "CP-401337-Apple",
                  "operationSetCode": "MacAppNotarize",
                  "parameters": [
                      {
                      "parameterName": "BundleId",
                      "parameterValue": 'com.microsoft.accessibilityinsights.unified.${{ parameters.channel }}'
                      }
                  ],
                  "toolName": "sign",
                  "toolVersion": "1.0"
                  }
              ]
